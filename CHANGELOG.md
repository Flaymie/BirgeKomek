# Список изменений

## [Нерелизнуто]

### Добавлено
- Настроен начальный проект бэкенда
- Создан package.json с необходимыми зависимостями
- Настроен файл .env с параметрами подключения
- Создана модель User для пользователей (ученики/помощники)
- Создана модель Request для запросов на помощь
- Создана модель Message для сообщений в чате
- Создана модель Review для отзывов и рейтингов
- Реализованы API-эндпоинты для аутентификации (регистрация, вход)
- Реализованы API-эндпоинты для работы с запросами (создание, получение, фильтрация)
- Реализованы API-эндпоинты для чата (отправка, получение, отметка о прочтении)
- Реализованы API-эндпоинты для отзывов (создание, получение)
- Создан middleware для авторизации и проверки прав
- Добавлена документация API с использованием Swagger (OpenAPI)
  - Добавлены схемы всех моделей данных
  - Добавлена документация API для аутентификации
  - Добавлена документация API для работы с заявками
  - Добавлена документация API для сообщений и чата
  - Добавлена документация API для отзывов и рейтингов
- Добавлены меры безопасности
  - Защита от NoSQL инъекций с express-mongo-sanitize
  - Валидация входных данных с express-validator
  - Безопасные HTTP заголовки с helmet
  - Обработка ошибок, не раскрывающая внутреннюю структуру
  - Очистка чувствительных данных в ответах
  - Ограничение размера JSON запросов
- Улучшен дизайн фронтенда
  - Добавлены анимации и эффекты для улучшения пользовательского опыта
  - Улучшен дизайн форм регистрации и входа
  - Создана привлекательная главная страница с анимированными элементами
  - Добавлены стилизованные компоненты для кнопок и карточек
  - Добавлены анимации для всех страниц приложения
  - Реализована плавная анимация при переходе между страницами
- Добавлены дополнительные страницы
  - Создана страница "Политика конфиденциальности"
  - Создана страница "Условия использования"
- Расширено API для заявок: CRUD операции, поиск, управление статусами (open, assigned, completed, cancelled), назначение хелпера.
- Реализовано API для обмена сообщениями в рамках конкретной заявки.
- Создано API для системы уведомлений пользователей (получение списка, отметка о прочтении одного/всех).
- Разработано API для сбора базовой статистики: общая статистика по платформе и статистика по конкретному пользователю.
- Вся новая функциональность API задокументирована с помощью Swagger.
- Система откликов на запросы помощи
  - Создание отклика хелпером
  - Получение списка откликов для запроса
  - Принятие/отклонение отклика автором запроса
- Уведомления о новых откликах
- Проверка прав доступа при работе с откликами

### Исправлено
- Исправлен путь к основному файлу в package.json
- Исправлено выравнивание навигационных элементов в хедере
- Устранена проблема с повторной анимацией элементов на главной странице
- Устранена проблема с повторной анимацией элементов на странице "О нас"
- Устранена ошибка при получении данных запроса, когда `currentUser` равен `null`
- Добавлена дополнительная проверка прав доступа к редактированию запроса
- Исправлены эндпоинты API для работы с откликами в клиентской части приложения

### Улучшено
- Автоматическая авторизация после регистрации
- Автоматический редирект при истечении токена на страницу входа
- Добавлена обработка 401 ошибки во всех запросах

# История изменений

## v0.3.1 (25.06.2025)

### Исправлено
- Исправлена система роутинга для профилей и запросов, чтобы корректно обрабатывать как ID, так и `username`.
- Добавлена обработка несуществующих (или удаленных) профилей и запросов. Теперь вместо ошибки отображается специальная страница "Не найдено".
- Подавлено логирование в консоль ожидаемых ошибок 404 (Не найдено) и 400 (Неверный ID), чтобы не засорять логи.

## v0.1.7 (20.06.2025)

### Добавлено
- Модальное окно создания запросов на помощь
  - Валидация формы с проверкой обязательных полей
  - Интеграция с API для отправки запросов
  - Автозаполнение класса из профиля пользователя
- Кнопка создания запроса на странице запросов
- Обновление списка запросов после создания нового

## v0.1.6 (19.06.2025)

### Добавлено
- Система уведомлений для пользователей
  - Иконка с счетчиком непрочитанных уведомлений в хедере
  - Страница для просмотра всех уведомлений
  - Возможность отметки уведомлений как прочитанных
  - Возможность удаления уведомлений
- Интеграция с API уведомлений на бэкенде

## v0.1.5 (19.06.2025)

### Добавлено
- Возможность редактирования класса пользователя в профиле
- Добавлен новый логотип в шапке сайта

### Изменено
- Удалена кнопка "Главная" из навигации как избыточная
- Улучшено отображение всплывающих подсказок в форме регистрации

### Исправлено
- Исправлена обработка ошибок при загрузке несуществующего профиля
- Предотвращение множественных запросов при просмотре профилей

## v0.2.8 (28 июня 2024)

### Добавлено
- Создана страница редактирования запроса по url `/request/:id/edit`
- Реализована валидация прав доступа (только автор может редактировать)
- Добавлено сохранение исходных значений полей для редактирования
- При успешном обновлении пользователь перенаправляется на страницу запроса

## v0.2.7 (27 июня 2024)

### Исправлено
- Изменено поведение счетчика символов в форме создания запроса: теперь показывается только когда осталось ≤100 символов

## v0.2.6 (27 июня 2024)

### Улучшения
- Добавлено ограничение в 2000 символов для описания запроса
- Добавлен счетчик оставшихся символов с цветовой индикацией
- Удалено неиспользуемое поле "срок выполнения" из формы создания запроса

## v0.2.5 (26 июня 2024)

### Улучшения
- Улучшена страница деталей запроса: добавлена информация о том, что пользователь является автором
- Добавлены специальные действия для автора запроса (редактирование и удаление)
- Реализовано сохранение пути перехода для корректного возврата к "Моим запросам"
- Добавлено модальное окно подтверждения перед удалением запроса

## v0.2.4 (25 июня 2024)

### Улучшения
- Добавлена интеграция карточек популярных предметов на главной странице с фильтрацией на странице запросов
- Улучшена навигация: при переходе с главной по предмету сразу применяется фильтр
- Добавлено сохранение выбранных фильтров в URL для возможности делиться ссылками на отфильтрованные запросы

## v0.2.3 (23 июня 2024)

### Добавлено
- Создана страница "Мои запросы" для просмотра запросов текущего пользователя
- Добавлена фильтрация запросов по предметам и поиск по названию

## v0.2.2 (21 июня 2024)

### Улучшения
- Упрощена логика фильтрации запросов: теперь на главной странице отображаются только открытые запросы
- Улучшен интерфейс страницы запросов для большей интуитивности

## v0.2.1 (20 июня 2024)

### Исправления
- Исправлена проблема отображения кнопки "Предложить помощь" - теперь она видна только хелперам и модераторам
- Исправлено отображение специальных символов в описании запросов (например, < >)
- Исправлена проблема с фильтрацией запросов по статусу
- Исправлен текст кнопки "Создать первый запрос" на "Создать запрос"
- Исправлена проблема с просмотром профилей пользователей по ID
- Временно отключены уведомления до реализации API

## v0.2.0 (15 июня 2024)

### Добавлено
- Создана страница запросов на помощь с фильтрами и пагинацией
- Добавлена возможность создания, просмотра и обновления запросов
- Добавлен чат для взаимодействия между учеником и помощником
- Реализована система оценки помощи и отзывов

### Улучшения
- Переработан дизайн главной страницы
- Улучшена навигация по сайту
- Оптимизирована мобильная версия

## v0.1.0 (1 июня 2024)

### Добавлено
- Базовая аутентификация (регистрация, вход, восстановление пароля)
- Личный кабинет пользователя
- Страница "О нас"
- Главная страница с информацией о проекте
 
## v0.2.9 (24.06.2025)

### Добавлено
- Реализована система отслеживания онлайн-статуса пользователей в реальном времени через WebSocket.
- В профиле пользователя теперь отображается его текущий онлайн-статус.
- Добавлена система аватарок для пользователей с авто-генерацией заглушки по имени.

### Улучшено
- Полностью переработан выпадающий список уведомлений в шапке сайта:
  - При открытии отображаются 5 последних уведомлений.
  - Все непрочитанные уведомления автоматически помечаются как прочитанные при открытии списка.
  - Исправлена верстка: список уведомлений теперь имеет прокрутку, что предотвращает выталкивание кнопки "Все уведомления".
- Оптимизирована работа с сокетами через глобальный `SocketContext` на фронтенде.
- Улучшена производительность API для получения уведомлений.

### Исправлено
- Устранены ошибки в логике работы сокетов на бэкенде и фронтенде.
- Исправлена ошибка, из-за которой в выпадающем списке отображалось больше 4 уведомлений.

### Добавлено
- Настроен начальный проект бэкенда
- Создан package.json с необходимыми зависимостями

# Журнал изменений

## [0.3.0] - 2025-06-24

### ✨ Добавлено
- **Полный функционал чата:** Реализована возможность редактирования и удаления сообщений прямо в интерфейсе чата.
- **Drag-and-Drop для файлов:** Добавлена возможность прикреплять файлы к сообщениям путем их перетаскивания в окно чата.
- **Улучшенная обработка файлов:** Бэкенд теперь корректно обрабатывает кириллические имена файлов и расширенный список типов файлов, включая архивы (`.rar`, `.zip`, `.7z`) и образы (`.iso`).
- **Улучшенная валидация файлов:** На бэкенде внедрена проверка файлов по расширению вместо MIME-типа и добавлен корректный обработчик ошибок `multer`.
- **Индикация редактирования:** У отредактированных сообщений появляется пометка `(изм.)`.
- **"Мягкое" удаление:** Удаленные сообщения заменяются на "Сообщение удалено", сохраняя целостность истории чата.
- **Кнопка "Назад":** Добавлена кнопка для быстрого возврата к списку чатов.

### 🎨 Улучшено
- **Переработан просмотрщик изображений:**
  - Полностью переделан интерфейс модального окна для просмотра вложений.
  - Реализована система зума: по умолчанию картинки вписываются в заданный размер, по клику отображаются в 100% масштабе.
  - Размеры по умолчанию сделаны адаптивными: большие для мобильных устройств, компактные для десктопов.
  - Кнопки управления больше не перекрывают изображение.
- **Отображение изображений в чате:** Убраны лишние рамки и фон у сообщений, состоящих только из картинок. Временная метка теперь накладывается поверх изображения.
- **Превью вложений:** Улучшен интерфейс превью файла перед отправкой, добавлена кастомная всплывающая подсказка с именем файла.

### 🐞 Исправлено
- Исправлена 500-я ошибка сервера при загрузке файлов, тип которых не был определен.
- Устранена перезагрузка страницы при сохранении отредактированного сообщения.

# Журнал изменений "Бірге Көмек"

## v0.4.3 (26.06.2025)

### ✨ Добавлено
- **Зарезервированные имена пользователей:** Добавлен черный список имен (admin, moderator, support и т.д.), которые нельзя использовать при регистрации.

### 🔒 Безопасность
- **Улучшена проверка зарезервированных никнеймов:** Теперь система блокирует не только точное совпадение, но и содержание зарезервированного слова в нике (например, `myadmin` будет заблокирован).

### 🐞 Исправлено
- **Текст при входе через Telegram:** Исправлено некорректное сообщение, которое получал пользователь в боте после подтверждения входа. Теперь текст соответствует действию.

## v0.4.2 (26.06.2025)

### ✨ Добавлено
- **Верификация номера телефона через Telegram:** Убран ручной ввод номера. Теперь телефон запрашивается и подтверждается исключительно через Telegram при регистрации или привязке аккаунта, что гарантирует его подлинность.
- **Новый логотип и фирменный стиль:** Заменен стандартный логотип React на фирменный логотип проекта. Обновлены заголовок и мета-описание сайта.

### 🔒 Безопасность
- **Ограничение частоты запросов (Rate Limiting):** Для всех маршрутов API внедрен `rate-limit` для защиты от брутфорс-атак и злоупотреблений.

### 🎨 Улучшено
- **Документация API:** Наведена чистота в тегах Swagger. Маршруты, связанные с Telegram и сбросом пароля, вынесены в отдельные категории для удобства навигации.

### 🐞 Исправлено
- Исправлена ошибка синтаксиса в Swagger-документации, которая мешала корректному отображению API.

## v0.4.0 (26.06.2025)

### ✨ Добавлено
- **Уведомления через Telegram:** Пользователи, привязавшие свой аккаунт, теперь получают уведомления о важных событиях прямо в Telegram.
- **Настройки уведомлений в боте:** Добавлена команда `/settings`, позволяющая пользователям включать или отключать получение уведомлений через Telegram.
- **Реализована полная аутентификация через Telegram!**
  - Пользователи теперь могут регистрироваться и входить в свои аккаунты с помощью Telegram-бота.
  - **Бот:** Переработана логика `/start`. Теперь бот корректно обрабатывает пользователей, пришедших с сайта по специальным ссылкам для регистрации и входа.
  - **Бэкенд:** Добавлены новые API-эндпоинты (`/api/auth/telegram/*`) для поддержки безопасного входа через временные токены и регистрации через бота.
  - **Фронтенд:** На страницах входа и регистрации появились кнопки "Войти/Зарегистрироваться через Telegram". Реализовано модальное окно с QR-кодом и поллингом статуса для удобного входа. Добавлена страница-коллбэк для завершения регистрации.

### 🐞 Исправлено
- **Кнопка "Пометить как прочитанное":** В Telegram-уведомлениях убрана лишняя кнопка, осталась только кнопка "Перейти" для простоты и удобства.

### 🎨 Улучшено
- **Логика отправки уведомлений:** Бэкенд теперь проверяет, включены ли у пользователя уведомления в Telegram, перед их отправкой.

## [0.4.1] - 2025-06-27

### Исправлено
- **Отзывы**: Устранена критическая ошибка, из-за которой падал фронтенд при отображении отзывов. Проблема была в несоответствии полей (`reviewerId` -> `author`, `requestId` -> `request`) между бэкендом и фронтендом.
- **Отзывы**: Добавлена серверная фильтрация отзывов, чтобы исключить те, у которых удален автор или связанная заявка.
- **Отзывы**: На фронтенде добавлены проверки на наличие автора и заявки перед рендерингом компонента отзыва для предотвращения падений.
- **Layout**: Футер теперь корректно скрывается на странице чата (`/requests/:id/chat`) для улучшения пользовательского опыта.

## v0.4.3 (01.07.2025)

### ✨ Добавлено
- **Форматирование номера телефона:** Номер телефона в профиле теперь отображается в красивом международном формате (например, `+7 (777) 123-45-67`).

### 🔒 Безопасность
- **Ограничение на смену ника:** Пользователи теперь могут менять свой никнейм не чаще, чем раз в 30 дней, для предотвращения злоупотреблений.
- **Скрытие номера телефона:** Номер телефона пользователя больше не отображается в публичном профиле.

### 🐞 Исправлено
- **Консистентность статусов**: Устранена путаница со статусами заявок. Теперь статус "Завершена" (`completed`) имеет одинаковое название и цвет (зеленый) на всех страницах, включая "Мои заявки" и "Детали заявки".
- **Критическая ошибка рендеринга `StatusBadge`**: Исправлена ошибка "Element type is invalid", возникавшая из-за некорректного экспорта компонента `StatusBadge`.
- **Критические ошибки аутентификации и авторизации:**
  - Полностью переработана и исправлена логика обработки бана пользователя. Теперь при блокировке (в том числе самобане) корректно отображается модальное окно, а не происходит сбой приложения или авто-выход.
  - Исправлена фатальная ошибка, вызванная наличием вложенного `<Router>` в приложении.
  - Устранен сбой приложения из-за отсутствующего модуля `tokenStorage`.
  - Исправлена ошибка, из-за которой пользователя постоянно выкидывало из системы после входа из-за несоответствия ключей токена.
- **Ошибки профиля пользователя:**
  - Устранена ошибка `null is not an object`, возникавшая при попытке сменить никнейм на своей странице профиля.
  - Исправлена ошибка, из-за которой не появлялась модалка о необходимости привязки Telegram при попытке изменить профиль (`read-only` режим).
- **Рефакторинг**: Устранен дублирующийся код для отображения статусов. Компонент `RequestDetailPage` теперь использует общий, стандартизированный компонент `StatusBadge`.

### 🎨 Улучшено
- **Автоскролл для модальных окон:** В модальное окно подтверждения смены никнейма добавлен автоматический скролл для удобства пользователя.